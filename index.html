<!doctype html>
<html lang="da">
<head>
<meta charset="utf-8">
<title>PTFS ATIS - Flightplan Manager</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial, sans-serif; background:#0f172a; color:white; padding:20px; }
  h1,h2 { color:#38bdf8; }
  form, .panel { background:#1e293b; padding:15px; border-radius:8px; margin-bottom:20px; }
  label { display:block; margin-top:10px; }
  input, select, button { width:100%; padding:8px; border-radius:4px; border:none; margin-top:5px; }
  button { cursor:pointer; font-weight:bold; }
  ul { list-style:none; padding:0; }
  li { background:#1e293b; margin:5px 0; padding:10px; border-radius:6px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; position:relative; }
  .hidden { display:none; }
  .status-btn { margin-left:5px; padding:4px 6px; border-radius:4px; font-size:12px; font-weight:bold; color:white; }
  .tooltip { position:absolute; background:#1e293b; padding:5px 8px; border-radius:4px; font-size:12px; top:-25px; left:0; display:none; white-space:nowrap; }
  li:hover .tooltip { display:block; }
</style>
</head>
<body>

<h1>PTFS ATIS - Flightplans</h1>

<!-- Pilot flightplan form -->
<form id="fp-form">
  <label>Callsign <input id="callsign" required></label>
  <label>Aircraft type <input id="type" required></label>
  <label>Departure
    <select id="dep" required>
      <option value="IRFD">Greater Rockford Airport</option>
      <option value="ILKL">Lukla International Airport</option>
      <option value="IPPH">Perth International Airport</option>
      <option value="ITKO">Tokyo International Airport</option>
      <option value="ILAR">Larnaca International Airport</option>
      <option value="IPAP">Paphos International Airport</option>
      <option value="IGRV">Grindavik Airport</option>
      <option value="IDCS">Saba International Airport</option>
      <option value="IGAR">Airbase Garry</option>
      <option value="IBLT">Boltic Airfield</option>
      <option value="IHEN">Henstridge Airfield</option>
      <option value="ISCM">RAF Scampton</option>
      <option value="IJAF">Al Najaf Airfield</option>
      <option value="IZOL">Izolirani Airport</option>
      <option value="ITRC">Training Centre</option>
    </select>
  </label>
  <label>Arrival
    <select id="arr" required>
      <option value="IRFD">Greater Rockford Airport</option>
      <option value="ILKL">Lukla International Airport</option>
      <option value="IPPH">Perth International Airport</option>
      <option value="ITKO">Tokyo International Airport</option>
      <option value="ILAR">Larnaca International Airport</option>
      <option value="IPAP">Paphos International Airport</option>
      <option value="IGRV">Grindavik Airport</option>
      <option value="IDCS">Saba International Airport</option>
      <option value="IGAR">Airbase Garry</option>
      <option value="IBLT">Boltic Airfield</option>
      <option value="IHEN">Henstridge Airfield</option>
      <option value="ISCM">RAF Scampton</option>
      <option value="IJAF">Al Najaf Airfield</option>
      <option value="IZOL">Izolirani Airport</option>
      <option value="ITRC">Training Centre</option>
    </select>
  </label>
  <label>Cruise altitude <input id="alt" required></label>
  <label>ETA <input id="eta" required placeholder="00:45"></label>
  <label>Flight rules
    <select id="rules">
      <option value="IFR">IFR</option>
      <option value="VFR">VFR</option>
    </select>
  </label>
  <button type="submit">Submit Flightplan</button>
</form>

<h2>Active Flightplans</h2>
<ul id="plans"></ul>

<!-- ATC Login -->
<div class="panel">
  <h2>ATC Login</h2>
  <label>Navn <input type="text" id="atc-name" placeholder="ATC navn"></label>
  <label>PIN <input type="password" id="atc-pin" placeholder="Enter ATC PIN"></label>
  <label>Lufthavn
    <select id="atc-airport">
      <option value="IRFD">Greater Rockford Airport</option>
      <option value="ILKL">Lukla International Airport</option>
      <option value="IPPH">Perth International Airport</option>
      <option value="ITKO">Tokyo International Airport</option>
      <option value="ILAR">Larnaca International Airport</option>
      <option value="IPAP">Paphos International Airport</option>
      <option value="IGRV">Grindavik Airport</option>
      <option value="IDCS">Saba International Airport</option>
      <option value="IGAR">Airbase Garry</option>
      <option value="IBLT">Boltic Airfield</option>
      <option value="IHEN">Henstridge Airfield</option>
      <option value="ISCM">RAF Scampton</option>
      <option value="IJAF">Al Najaf Airfield</option>
      <option value="IZOL">Izolirani Airport</option>
      <option value="ITRC">Training Centre</option>
    </select>
  </label>
  <label>Rolle
    <select id="atc-role">
      <option value="Ground">Ground</option>
      <option value="Tower">Tower</option>
      <option value="Approach">Approach</option>
    </select>
  </label>
  <button id="login-btn">Login</button>
</div>

<!-- ATC Panel -->
<div id="atc-panel" class="panel hidden">
  <h2>ATC Panel</h2>
  <p>Velkommen, <span id="atc-display"></span>! Farvekodede status-knapper:</p>
  <ul id="atc-plans"></ul>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAqmFP49513SIEYDTPGDRlgQ2sttbCEVps",
  authDomain: "ptfsfligtplan.firebaseapp.com",
  projectId: "ptfsfligtplan",
  storageBucket: "ptfsfligtplan.firebasestorage.app",
  messagingSenderId: "109109884359",
  appId: "1:109109884359:web:c69698533bbe25c80b55e2",
  measurementId: "G-ZERL7Y4ERS"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

function generateSquawk() {
  return Math.floor(1000 + Math.random()*9000);
}

// Submit flightplan
document.getElementById("fp-form").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const plan = {
    callsign: document.getElementById("callsign").value,
    type: document.getElementById("type").value,
    dep: document.getElementById("dep").value,
    arr: document.getElementById("arr").value,
    alt: document.getElementById("alt").value,
    eta: document.getElementById("eta").value,
    rules: document.getElementById("rules").value,
    squawk: generateSquawk(),
    status: "Filed",
    time: new Date().toISOString()
  };
  await db.collection("flightplans").add(plan);
  alert("Flightplan submitted ✅ Squawk: "+plan.squawk);
  e.target.reset();
});

// Live pilot view
db.collection("flightplans").orderBy("time","desc").onSnapshot(snapshot=>{
  const list = document.getElementById("plans");
  list.innerHTML="";
  snapshot.forEach(doc=>{
    const d = doc.data();
    const li = document.createElement("li");
    li.textContent = `${d.callsign} | ${d.type} | ${d.dep}→${d.arr} | FL:${d.alt} | ETA:${d.eta} | ${d.rules} | Squawk:${d.squawk}`;
    list.appendChild(li);
  });
});

let currentATC = null;

// ATC login
document.getElementById("login-btn").addEventListener("click", ()=>{
  const name = document.getElementById("atc-name").value;
  const pin = document.getElementById("atc-pin").value;
  const airport = document.getElementById("atc-airport").value;
  const role = document.getElementById("atc-role").value;
  if(pin === "1234"){
    currentATC = {name, airport, role};
    document.getElementById("atc-panel").classList.remove("hidden");
    document.getElementById("atc-display").textContent = `${name} (${role})`;
    loadAtcPanel();
  } else alert("Forkert PIN!");
});

// ATC panel – farver + tooltip
function loadAtcPanel(){
  db.collection("flightplans").orderBy("time","desc").onSnapshot(snapshot=>{
    const list = document.getElementById("atc-plans");
    list.innerHTML="";
    snapshot.forEach(doc=>{
      const d = doc.data();
      if(d.dep !== currentATC.airport && d.arr !== currentATC.airport) return;

      const li = document.createElement("li");
      const fromTo = d.dep === currentATC.airport ? `Departure from here → ${d.arr}` : `Arrival from ${d.dep} → here`;
      li.textContent = `${d.callsign} | ${d.type} | ${fromTo} | FL:${d.alt} | ETA:${d.eta} | ${d.rules} | Squawk:${d.squawk} | Status:`;

      // Tooltip
      const tooltip = document.createElement("div");
      tooltip.className = "tooltip";
      tooltip.textContent = `Departure: ${d.dep} | Arrival: ${d.arr} | ETA: ${d.eta}`;
      li.appendChild(tooltip);

      const statuses = {"Filed":"#38bdf8","Cleared":"#facc15","Taxi":"#f97316","Airborne":"#22c55e"};
      Object.keys(statuses).forEach(s=>{
        const btn = document.createElement("button");
        btn.className="status-btn";
        btn.textContent = s;
        btn.style.background=statuses[s];
        btn.onclick=()=>db.collection("flightplans").doc(doc.id).update({status:s});
        li.appendChild(btn);
      });

      const del = document.createElement("button");
      del.textContent="❌ Slet";
      del.style.background="#ef4444";
      del.onclick=()=>db.collection("flightplans").doc(doc.id).delete();
      li.appendChild(del);

      list.appendChild(li);
    });
  });
}
</script>
</body>
</html>
