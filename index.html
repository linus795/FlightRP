<!doctype html>
<html lang="da">
<head>
<meta charset="utf-8">
<title>PTFS ATIS - All-in-One (ATC-protected delete + Global Chat)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root{--bg:#0b1220;--card:#0f1724;--accent:#06b6d4;--muted:#94a3b8;--ok:#16a34a;--warn:#f97316;--danger:#ef4444}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter, Arial, sans-serif;background:linear-gradient(180deg,var(--bg),#07101a);color:#e6eef6;padding:18px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  h1{margin:0;color:var(--accent);font-size:20px}
  .container{display:grid;grid-template-columns:380px 1fr;gap:18px;margin-top:16px}
  .panel{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
  label{display:block;font-size:13px;color:var(--muted);margin-top:8px}
  input,select,textarea,button{width:100%;padding:8px;border-radius:8px;border:none;background:#071428;color:inherit}
  button{cursor:pointer}
  .muted{color:var(--muted);font-size:13px}
  .plans-list{list-style:none;padding:0;margin:0;display:grid;gap:8px}
  .plan{display:flex;flex-direction:column;padding:10px;border-radius:8px;background:linear-gradient(180deg,#0b1624,#081220);}
  .plan-row{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .tags{display:flex;gap:6px;flex-wrap:wrap}
  .tag{font-size:12px;padding:4px 8px;border-radius:999px}
  .tag.sq{background:#0b3b66;color:#bde7ff}
  .tag.alt{background:#082e20;color:#c8f7df}
  .actions{display:flex;gap:6px}
  .status-btn{padding:6px 8px;border-radius:6px;font-weight:600}
  .controls{display:flex;gap:8px;align-items:center}
  .toolbar{display:flex;gap:10px;align-items:center}
  .flex{display:flex;gap:10px}
  .right{justify-content:flex-end}
  .small{font-size:12px}
  .footer{margin-top:12px;color:var(--muted);font-size:13px}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  @media(max-width:900px){.container{grid-template-columns:1fr}header{flex-direction:column;align-items:flex-start}}
  /* modal */
  .modal{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;align-items:center;justify-content:center;padding:20px}
  .modal.open{display:flex}
  .modal-card{width:880px;max-width:100%;background:var(--card);padding:16px;border-radius:10px}
  .row{display:flex;gap:8px;align-items:center}
  .icon{width:36px;height:36px;border-radius:8px;background:#022235;display:flex;align-items:center;justify-content:center}
  .import-area{height:120px}
  /* chat */
  .chat{display:flex;flex-direction:column;gap:8px;height:320px}
  .chat-messages{flex:1;overflow:auto;padding:8px;border-radius:8px;background:#06101a}
  .chat-message{padding:8px;border-radius:8px;margin-bottom:6px;background:linear-gradient(180deg,#071826,#05121a)}
  .chat-meta{font-size:12px;color:var(--muted)}
</style>
</head>
<body>
<header>
  <div>
    <h1>PTFS ATIS ‚Äî All-in-One</h1>
    <div class="muted">Opret, rediger, filtrer, eksport√©r og administr√©r flightplans. Kun ATC kan slette. Global chat pr. lufthavn.</div>
  </div>
  <div class="controls">
    <div class="toolbar">
      <select id="filter-airport"><option value="">Alle lufthavne</option></select>
      <select id="filter-status"><option value="">Alle statusser</option><option>Filed</option><option>Cleared</option><option>Taxi</option><option>Airborne</option></select>
      <input id="q" placeholder="S√∏g callsign, dep, arr..." style="width:240px">
      <button id="btn-export">Eksport√©r JSON</button>
      <button id="btn-import">Import√©r JSON</button>
    </div>
    <div class="right">
      <button id="btn-clear">Slet alle (DB)</button>
    </div>
  </div>
</header>

<div class="container">
  <aside class="panel">
    <h2 style="margin:0 0 8px 0">Opret / Rediger flightplan</h2>
    <form id="fp-form">
      <label>Callsign <input id="callsign" required></label>
      <label>Aircraft type <input id="type" required></label>
      <div class="grid-2">
        <div>
          <label>Departure
            <select id="dep" required></select>
          </label>
        </div>
        <div>
          <label>Arrival
            <select id="arr" required></select>
          </label>
        </div>
      </div>
      <div class="grid-2">
        <label>Cruise altitude <input id="alt" required placeholder="e.g. 350" type="number"></label>
        <label>ETA <input id="eta" required placeholder="HH:MM"></label>
      </div>
      <label>Flight rules
        <select id="rules"><option>IFR</option><option>VFR</option></select>
      </label>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="submit-btn" type="submit">Gem flightplan</button>
        <button id="reset-btn" type="button">Nulstil</button>
        <button id="assign-squawk" type="button">Tildel unik squawk</button>
      </div>
      <input type="hidden" id="fp-id">
    </form>

    <hr style="border:none;border-top:1px solid #0b2a3c;margin:12px 0">
    <h3 style="margin:0">ATC Login</h3>
    <label>Navn <input id="atc-name"></label>
    <label>PIN <input id="atc-pin" type="password" placeholder="1234"></label>
    <label>Lufthavn <select id="atc-airport"></select></label>
    <label>Rolle <select id="atc-role"><option>Ground</option><option>Tower</option><option>Approach</option></select></label>
    <div style="display:flex;gap:8px;margin-top:8px"><button id="atc-login">Login</button><button id="atc-logout" style="display:none">Logout</button></div>

    <div class="footer">Tip: brug eksport/import for backup. Appen k√∏rer lokalt via LocalStorage.</div>
  </aside>

  <main>
    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2 style="margin:0">Aktive flightplans</h2>
        <div class="muted small">Sort√©r: <select id="sort"><option value="time_desc">Nyeste</option><option value="time_asc">√Üldste</option><option value="eta_asc">ETA stigende</option><option value="eta_desc">ETA faldende</option></select></div>
      </div>

      <ul id="plans" class="plans-list" style="margin-top:12px"></ul>
    </div>

    <div class="panel" style="margin-top:12px">
      <h3>Handlinger og eksport</h3>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="export-csv">Eksport√©r CSV</button>
        <button id="bulk-delete">Slet valgte</button>
        <button id="select-all">V√¶lg alle</button>
        <button id="deselect-all">Frav√¶lg</button>
      </div>
    </div>

    <div class="panel" style="margin-top:12px">
      <h3>Global Chat (pr. lufthavn / Alle)</h3>
      <div style="display:flex;gap:8px;margin-bottom:8px">
        <select id="chat-filter-airport"><option value="ALL">ALL (global)</option></select>
        <input id="chat-filter-q" placeholder="S√∏g i chat...">
        <button id="chat-clear">Ryd chat (ATC only)</button>
      </div>
      <div class="chat">
        <div id="chat-messages" class="chat-messages"></div>
        <div style="display:flex;gap:8px">
          <select id="chat-airport"></select>
          <input id="chat-name" placeholder="Navn / Callsign" style="width:180px">
          <input id="chat-text" placeholder="Skriv besked...">
          <button id="chat-send">Send</button>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Modal: Import -->
<div id="modal" class="modal">
  <div class="modal-card">
    <h3>Importer flightplans (JSON)</h3>
    <textarea id="import-json" class="import-area" placeholder='Inds√¶t JSON array af flightplans'></textarea>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="do-import">Importer</button>
      <button id="close-modal">Luk</button>
    </div>
  </div>
</div>

<script>
/* Client-side Flightplan Manager with ATC-protected deletions and Global Chat
   - Persistence: localStorage
   - Only logged-in ATC (PIN 1234) may delete flightplans or clear DB / chat
*/

const DEFAULT_AIRPORTS = [
  {code:'IRFD',name:'Greater Rockford Airport'},
  {code:'ILKL',name:'Lukla International Airport'},
  {code:'IPPH',name:'Perth International Airport'},
  {code:'ITKO',name:'Tokyo International Airport'},
  {code:'ILAR',name:'Larnaca International Airport'},
  {code:'IPAP',name:'Paphos International Airport'},
  {code:'IGRV',name:'Grindavik Airport'},
  {code:'IDCS',name:'Saba International Airport'},
  {code:'IGAR',name:'Airbase Garry'},
  {code:'IBLT',name:'Boltic Airfield'},
  {code:'IHEN',name:'Henstridge Airfield'},
  {code:'ISCM',name:'RAF Scampton'},
  {code:'IJAF',name:'Al Najaf Airfield'},
  {code:'IZOL',name:'Izolirani Airport'},
  {code:'ITRC',name:'Training Centre'}
];

// DOM
const dep = document.getElementById('dep');
const arr = document.getElementById('arr');
const atcAirport = document.getElementById('atc-airport');
const filterAirport = document.getElementById('filter-airport');
const plansEl = document.getElementById('plans');
const fpForm = document.getElementById('fp-form');
const fpId = document.getElementById('fp-id');
const q = document.getElementById('q');
const filterStatus = document.getElementById('filter-status');
const sortSelect = document.getElementById('sort');
const modal = document.getElementById('modal');
const importJson = document.getElementById('import-json');

// chat DOM
const chatMessages = document.getElementById('chat-messages');
const chatAirport = document.getElementById('chat-airport');
const chatFilterAirport = document.getElementById('chat-filter-airport');
const chatName = document.getElementById('chat-name');
const chatText = document.getElementById('chat-text');
const chatSend = document.getElementById('chat-send');
const chatFilterQ = document.getElementById('chat-filter-q');
const chatClear = document.getElementById('chat-clear');

// buttons
const btnExport = document.getElementById('btn-export');
const btnImport = document.getElementById('btn-import');
const btnClear = document.getElementById('btn-clear');
const btnAssignSquawk = document.getElementById('assign-squawk');
const submitBtn = document.getElementById('submit-btn');
const resetBtn = document.getElementById('reset-btn');
const atcLogin = document.getElementById('atc-login');
const atcLogout = document.getElementById('atc-logout');
const btnExportCsv = document.getElementById('export-csv');
const btnBulkDelete = document.getElementById('bulk-delete');
const btnSelectAll = document.getElementById('select-all');
const btnDeselectAll = document.getElementById('deselect-all');
const btnDoImport = document.getElementById('do-import');
const btnCloseModal = document.getElementById('close-modal');

// form fields
const callsign = document.getElementById('callsign');
const typeField = document.getElementById('type');
const alt = document.getElementById('alt');
const eta = document.getElementById('eta');
const rules = document.getElementById('rules');

// storage keys
const KEY = 'ptfs_flightplans_v2';
const KEY_ATC = 'ptfs_atc_v2';
const KEY_CHAT = 'ptfs_chat_v1';

let flightplans = load();
let atc = loadAtc();
let chat = loadChat();
let selectedIds = new Set();

// init
function init(){
  populateAirports();
  populateFilters();
  render();
  renderChat();
}

function populateAirports(){
  DEFAULT_AIRPORTS.forEach(a=>{
    const opt = option(a.code, `${a.code} ‚Äî ${a.name}`);
    dep.appendChild(opt.cloneNode(true));
    arr.appendChild(opt.cloneNode(true));
    atcAirport.appendChild(opt.cloneNode(true));
    filterAirport.appendChild(opt.cloneNode(true));
    chatAirport.appendChild(option(a.code,a.code+' ‚Äî '+a.name));
    chatFilterAirport.appendChild(option(a.code,a.code+' ‚Äî '+a.name));
    filterAirport.appendChild(opt.cloneNode(true));
  });
  // add ALL option to chat selects
  chatAirport.insertBefore(option('ALL','ALL (global)'), chatAirport.firstChild);
  chatFilterAirport.insertBefore(option('ALL','ALL (global)'), chatFilterAirport.firstChild);
}
function populateFilters(){ }
function option(value,text){const o=document.createElement('option');o.value=value;o.textContent=text;return o}

function save(){localStorage.setItem(KEY, JSON.stringify(flightplans));}
function load(){try{return JSON.parse(localStorage.getItem(KEY)||'[]')}catch(e){return []}}
function saveAtc(){localStorage.setItem(KEY_ATC, JSON.stringify(atc));}
function loadAtc(){try{return JSON.parse(localStorage.getItem(KEY_ATC)||'null')}catch(e){return null}}
function saveChat(){localStorage.setItem(KEY_CHAT, JSON.stringify(chat));}
function loadChat(){try{return JSON.parse(localStorage.getItem(KEY_CHAT)||'[]')}catch(e){return []}}

function uid(){return 'fp_' + Math.random().toString(36).slice(2,9)}
function mid(){return 'm_' + Math.random().toString(36).slice(2,9)}

function uniqueSquawk(){
  const used = new Set(flightplans.map(f=>String(f.squawk)));
  let s; do{s = Math.floor(1000 + Math.random()*9000).toString()}while(used.has(s));
  return s;
}

// CRUD
fpForm.addEventListener('submit', (e)=>{
  e.preventDefault();
  const id = fpId.value || uid();
  const payload = {
    id,
    callsign: callsign.value.trim() || 'UNKNOWN',
    type: typeField.value.trim() || 'UNKNOWN',
    dep: dep.value,
    arr: arr.value,
    alt: alt.value || '',
    eta: eta.value || '',
    rules: rules.value,
    squawk: fpId.value ? (flightplans.find(f=>f.id===fpId.value)?.squawk || uniqueSquawk()) : uniqueSquawk(),
    status: 'Filed',
    time: Date.now()
  };

  const existing = flightplans.findIndex(f=>f.id===id);
  if(existing >= 0) flightplans[existing] = {...flightplans[existing], ...payload};
  else flightplans.unshift(payload);
  save();
  resetForm();
  render();
  alert('Flightplan gemt ‚úÖ Squawk: ' + payload.squawk);
});

resetBtn.addEventListener('click', resetForm);
function resetForm(){fpId.value='';fpForm.reset();}

btnAssignSquawk.addEventListener('click', ()=>{const s = uniqueSquawk();alert('Tildelt squawk: ' + s);});

// render
function render(){
  const qv = q.value.trim().toLowerCase();
  const fa = filterAirport.value;
  const fs = filterStatus.value;
  const sort = sortSelect.value;

  let list = flightplans.slice();
  if(qv) list = list.filter(f=>[f.callsign,f.dep,f.arr,f.type,f.squawk,(f.alt||'')].some(x=>String(x).toLowerCase().includes(qv)));
  if(fa) list = list.filter(f=>f.dep===fa || f.arr===fa);
  if(fs) list = list.filter(f=>f.status===fs);

  if(sort==='time_desc') list.sort((a,b)=>b.time-a.time);
  if(sort==='time_asc') list.sort((a,b)=>a.time-b.time);
  if(sort==='eta_asc') list.sort((a,b)=>parseEta(a.eta)-parseEta(b.eta));
  if(sort==='eta_desc') list.sort((a,b)=>parseEta(b.eta)-parseEta(a.eta));

  plansEl.innerHTML='';
  list.forEach(f=>plansEl.appendChild(renderPlan(f)));
}

function parseEta(t){ if(!t) return Infinity; const m = t.match(/^(\d{1,2}):(\d{2})$/); if(!m) return Infinity; return parseInt(m[1])*60 + parseInt(m[2]); }

function renderPlan(f){
  const li = document.createElement('li'); li.className='plan';
  const row = document.createElement('div'); row.className='plan-row';
  const left = document.createElement('div'); left.innerHTML = `<strong>${escapeHtml(f.callsign)}</strong> <span class="muted">${escapeHtml(f.type)}</span><div class="muted small">${f.dep} ‚Üí ${f.arr} ‚Ä¢ ETA ${f.eta || '-'} ‚Ä¢ ${f.rules}</div>`;
  const right = document.createElement('div'); right.className='tags';
  const t1 = document.createElement('span'); t1.className='tag sq'; t1.textContent = 'Squawk: ' + f.squawk;
  const t2 = document.createElement('span'); t2.className='tag alt'; t2.textContent = 'FL' + (f.alt||'-');
  right.appendChild(t1); right.appendChild(t2);
  row.appendChild(left); row.appendChild(right); li.appendChild(row);

  const actionRow = document.createElement('div'); actionRow.style.marginTop='8px'; actionRow.className='row';
  const actions = document.createElement('div'); actions.className='actions';
  ['Filed','Cleared','Taxi','Airborne'].forEach(s=>{
    const b = document.createElement('button'); b.textContent = s; b.className='status-btn';
    if(s==='Filed') b.style.background='#0b3b66';
    if(s==='Cleared') b.style.background='#facc15';
    if(s==='Taxi') b.style.background='#f97316';
    if(s==='Airborne') b.style.background='#16a34a';
    b.addEventListener('click', ()=>{updateStatus(f.id,s)});
    actions.appendChild(b);
  });

  const edit = document.createElement('button'); edit.textContent='‚úèÔ∏è'; edit.title='Rediger'; edit.addEventListener('click', ()=>loadForEdit(f.id));
  const del = document.createElement('button'); del.textContent='üóëÔ∏è'; del.title='Slet';
  del.addEventListener('click', ()=>{ if(!isAtcLoggedIn()){return alert('Kun ATC kan slette flightplans. Log ind med korrekt PIN.')} if(confirm('Slet flightplan?')){deletePlan(f.id)} });

  actions.appendChild(edit); actions.appendChild(del);

  // checkbox for bulk
  const cb = document.createElement('input'); cb.type='checkbox'; cb.style.marginRight='8px'; cb.checked = selectedIds.has(f.id);
  cb.addEventListener('change', ()=>{if(cb.checked) selectedIds.add(f.id); else selectedIds.delete(f.id)});

  actionRow.appendChild(cb); actionRow.appendChild(actions); li.appendChild(actionRow);

  const details = document.createElement('div'); details.className='muted small'; details.style.marginTop='6px'; details.textContent = `Status: ${f.status} ‚Ä¢ Oprettet: ${new Date(f.time).toLocaleString()}`;
  li.appendChild(details);
  return li;
}

function escapeHtml(s){return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;" })[c])}

function updateStatus(id,status){ const i = flightplans.findIndex(f=>f.id===id); if(i<0) return; flightplans[i].status = status; save(); render(); }
function deletePlan(id){ if(!isAtcLoggedIn()) return alert('Kun ATC kan slette'); flightplans = flightplans.filter(f=>f.id!==id); save(); render(); }
function loadForEdit(id){ const f = flightplans.find(x=>x.id===id); if(!f) return; fpId.value=f.id; callsign.value=f.callsign; typeField.value=f.type; dep.value=f.dep; arr.value=f.arr; alt.value=f.alt; eta.value=f.eta; rules.value=f.rules; window.scrollTo({top:0,behavior:'smooth'}); }

// search, filters
q.addEventListener('input', debounce(render,250));
filterAirport.addEventListener('change', render);
filterStatus.addEventListener('change', render);
sortSelect.addEventListener('change', render);

// export/import
btnExport.addEventListener('click', ()=>{ const dataStr = JSON.stringify(flightplans, null, 2); download('flightplans.json', dataStr); });
btnImport.addEventListener('click', ()=>{modal.classList.add('open'); importJson.value='';});
btnCloseModal.addEventListener('click', ()=>modal.classList.remove('open'));
btnDoImport.addEventListener('click', ()=>{ try{ const parsed = JSON.parse(importJson.value); if(!Array.isArray(parsed)) throw new Error('JSON skal v√¶re et array'); parsed.forEach(p=>{ if(!p.id) p.id = uid(); if(!p.squawk) p.squawk = uniqueSquawk(); p.time = p.time || Date.now(); flightplans.unshift(p); }); save(); render(); modal.classList.remove('open'); alert('Import f√¶rdig'); }catch(e){alert('Import fejl: ' + e.message)} });

// CSV export
btnExportCsv.addEventListener('click', ()=>{
  const header = ['id','callsign','type','dep','arr','alt','eta','rules','squawk','status','time'];
  const rows = flightplans.map(f=>header.map(h=>escapeCsv(String(f[h]||''))).join(','));
  const csv = header.join(',') + '\n' + rows.join('\n');
  download('flightplans.csv', csv);
});
function escapeCsv(s){if(s.includes(',')||s.includes('"')||s.includes('\n')) return '"'+s.replace(/"/g,'""')+'"'; return s}

// select/deselect/bulk delete
btnSelectAll.addEventListener('click', ()=>{flightplans.forEach(f=>selectedIds.add(f.id)); render();});
btnDeselectAll.addEventListener('click', ()=>{selectedIds.clear(); render();});
btnBulkDelete.addEventListener('click', ()=>{ if(selectedIds.size===0) return alert('Ingen valgte'); if(!isAtcLoggedIn()) return alert('Kun ATC kan slette flightplans'); if(!confirm('Slet valgte?')) return; flightplans = flightplans.filter(f=>!selectedIds.has(f.id)); selectedIds.clear(); save(); render(); });

// clear DB
btnClear.addEventListener('click', ()=>{ if(!isAtcLoggedIn()) return alert('Kun ATC kan slette alt'); if(confirm('Slet alle flightplans permanent?')){flightplans=[]; save(); render();}});

// atc login (local)
atcLogin.addEventListener('click', ()=>{
  const name = document.getElementById('atc-name').value.trim();
  const pin = document.getElementById('atc-pin').value.trim();
  const ap = atcAirport.value; const role = document.getElementById('atc-role').value;
  if(pin !== '1234'){return alert('Forkert PIN');}
  atc = {name, airport:ap, role, loggedAt:Date.now()}; saveAtc(); updateAtcUI(); render();
});
atcLogout.addEventListener('click', ()=>{atc=null; saveAtc(); updateAtcUI(); render();});

function updateAtcUI(){ if(atc){ atcLogin.style.display='none'; atcLogout.style.display='inline-block'; document.getElementById('atc-name').value = atc.name; document.getElementById('atc-pin').value=''; } else { atcLogin.style.display='inline-block'; atcLogout.style.display='none'; }}
function isAtcLoggedIn(){ return !!atc; }

// chat logic
chatSend.addEventListener('click', ()=>{ const txt = chatText.value.trim(); const name = chatName.value.trim() || (atc?atc.name:'Anon'); const airport = chatAirport.value || 'ALL'; if(!txt) return; const m = {id:mid(), author:name, airport, text:txt, time:Date.now()}; chat.push(m); saveChat(); chatText.value=''; renderChat(); });
chatFilterQ.addEventListener('input', debounce(renderChat,200));
chatFilterAirport.addEventListener('change', renderChat);
chatClear.addEventListener('click', ()=>{ if(!isAtcLoggedIn()) return alert('Kun ATC kan rydde chat'); if(!confirm('Ryd ALL chat?')) return; chat=[]; saveChat(); renderChat(); });

function renderChat(){ const qv = chatFilterQ.value.trim().toLowerCase(); const fa = chatFilterAirport.value || 'ALL'; chatMessages.innerHTML='';
  chat.slice().reverse().forEach(m=>{ if(fa !== 'ALL' && m.airport !== fa) return; if(qv && !(m.text.toLowerCase().includes(qv) || m.author.toLowerCase().includes(qv))) return; const div = document.createElement('div'); div.className='chat-message'; div.innerHTML = `<div><strong>${escapeHtml(m.author)}</strong> <span class="chat-meta">${m.airport} ‚Ä¢ ${new Date(m.time).toLocaleString()}</span></div><div style="margin-top:6px">${escapeHtml(m.text)}</div>`; const del = document.createElement('button'); del.textContent='üóëÔ∏è'; del.style.marginTop='6px'; del.addEventListener('click', ()=>{ if(!isAtcLoggedIn()) return alert('Kun ATC kan slette chatbeskeder'); if(confirm('Slet besked?')){ chat = chat.filter(x=>x.id!==m.id); saveChat(); renderChat(); }}); if(isAtcLoggedIn()) div.appendChild(del); chatMessages.appendChild(div); }); }

// chat airport default
chatAirport.value = 'ALL';

// download util
function download(filename, text){const a=document.createElement('a'); a.href = URL.createObjectURL(new Blob([text], {type:'text/plain'})); a.download = filename; document.body.appendChild(a); a.click(); a.remove();}

// debounce
function debounce(fn,ms){let t; return (...a)=>{clearTimeout(t); t=setTimeout(()=>fn(...a),ms)}}

// helpers
function seedIfEmpty(){ if(flightplans.length===0){ const sample = [ {id:uid(),callsign:'PTF001',type:'B738',dep:'IRFD',arr:'ITKO',alt:'350',eta:'14:30',rules:'IFR',squawk:uniqueSquawk(),status:'Filed',time:Date.now()-1000*60*60}, {id:uid(),callsign:'SKY12',type:'C172',dep:'IPPH',arr:'IRFD',alt:'050',eta:'15:20',rules:'VFR',squawk:uniqueSquawk(),status:'Cleared',time:Date.now()-1000*60*30} ]; flightplans = sample.concat(flightplans); save(); }
  if(chat.length===0){ chat.push({id:mid(),author:'System',airport:'ALL',text:'Velkommen til PTFS global chat ‚Äî ATC kan moderere beskeder.',time:Date.now()}); saveChat(); }
}

seedIfEmpty(); init(); updateAtcUI();

</script>
</body>
</html>
