<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8">
  <title>PTFS ATIS - Flightplan Manager</title>
  <style>
    body { font-family: Arial, sans-serif; background:#0f172a; color:white; padding:20px; }
    h1 { color:#38bdf8; }
    form, .panel { background:#1e293b; padding:15px; border-radius:8px; margin-bottom:20px; }
    label { display:block; margin-top:10px; }
    input, select { width:100%; padding:8px; border-radius:4px; border:none; margin-top:5px; }
    button { margin-top:15px; padding:10px; border:none; border-radius:6px; background:#38bdf8; color:black; font-weight:bold; cursor:pointer; }
    ul { list-style:none; padding:0; }
    li { background:#1e293b; margin:5px 0; padding:10px; border-radius:6px; display:flex; justify-content:space-between; align-items:center; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <h1>PTFS ATIS - Flightplans</h1>

  <!-- Flightplan form for piloter -->
  <form id="fp-form">
    <label>Callsign
      <input id="callsign" required>
    </label>
    <label>Aircraft type
      <input id="type" required>
    </label>
    <label>Departure (ICAO)
      <input id="dep" required>
    </label>
    <label>Arrival (ICAO)
      <input id="arr" required>
    </label>
    <label>Cruise altitude
      <input id="alt" required>
    </label>
    <label>Estimated time enroute
      <input id="eta" required placeholder="00:45">
    </label>
    <label>Flight rules
      <select id="rules">
        <option value="IFR">IFR</option>
        <option value="VFR">VFR</option>
      </select>
    </label>
    <button type="submit">Submit Flightplan</button>
  </form>

  <h2>Active Flightplans</h2>
  <ul id="plans"></ul>

  <!-- ATC Login -->
  <div class="panel">
    <h2>ATC Login</h2>
    <input type="password" id="atc-pin" placeholder="Enter ATC PIN">
    <button id="login-btn">Login</button>
  </div>

  <!-- ATC Panel (kun synlig for ATC) -->
  <div id="atc-panel" class="panel hidden">
    <h2>ATC Panel</h2>
    <p>Velkommen, ATC! Du kan cleare/slette flightplans.</p>
    <ul id="atc-plans"></ul>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // Din Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAqmFP49513SlEYDtPGDR1gQ2sttbCEVps",
      authDomain: "ptfsfligtplan.firebaseapp.com",
      projectId: "ptfsfligtplan",
      storageBucket: "ptfsfligtplan.appspot.com",
      messagingSenderId: "109109884359",
      appId: "1:109109884359:web:c69695833bbe25c80b55e2",
      measurementId: "G-ZERL7Y4ERS"
    };

    // Init Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Submit flightplan
    document.getElementById("fp-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const plan = {
        callsign: document.getElementById("callsign").value,
        type: document.getElementById("type").value,
        dep: document.getElementById("dep").value,
        arr: document.getElementById("arr").value,
        alt: document.getElementById("alt").value,
        eta: document.getElementById("eta").value,
        rules: document.getElementById("rules").value,
        time: new Date().toISOString(),
        squawk: Math.floor(1000 + Math.random() * 9000)
      };
      await db.collection("flightplans").add(plan);
      alert("Flightplan submitted âœ… Squawk: " + plan.squawk);
      e.target.reset();
    });

    // Vis flightplans til alle (piloter/ATC)
    db.collection("flightplans").orderBy("time", "desc").onSnapshot(snapshot => {
      const list = document.getElementById("plans");
      list.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement("li");
        li.textContent = `${data.callsign} | ${data.type} | ${data.dep} â†’ ${data.arr} | ${data.rules} | FL:${data.alt} | ETA:${data.eta} | Squawk:${data.squawk}`;
        list.appendChild(li);
      });
    });

    // ATC Login
    const ATC_PIN = "1234"; // ðŸ”‘ Skift denne til din hemmelige kode
    document.getElementById("login-btn").addEventListener("click", () => {
      const pin = document.getElementById("atc-pin").value;
      if (pin === ATC_PIN) {
        document.getElementById("atc-panel").classList.remove("hidden");
        loadAtcPlans();
      } else {
        alert("Forkert PIN!");
      }
    });

    // ATC-panel viser flightplans med delete-knap
    function loadAtcPlans() {
      db.collection("flightplans").orderBy("time", "desc").onSnapshot(snapshot => {
        const list = document.getElementById("atc-plans");
        list.innerHTML = "";
        snapshot.forEach(doc => {
          const data = doc.data();
          const li = document.createElement("li");
          li.textContent = `${data.callsign} | ${data.dep} â†’ ${data.arr} | ${data.rules} | Squawk:${data.squawk}`;
          const btn = document.createElement("button");
          btn.textContent = "âŒ Slet";
          btn.onclick = () => db.collection("flightplans").doc(doc.id).delete();
          li.appendChild(btn);
          list.appendChild(li);
        });
      });
    }
  </script>
</body>
</html>
